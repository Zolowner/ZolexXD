local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local CamlockState = false
local Prediction = 0.165771
local HorizontalPrediction = 0.129762
local VerticalPrediction = 0.11746444
local XPrediction = 16
local YPrediction = 16

local Locked = true

getgenv().Key = "q"

game.StarterGui:SetCore("SendNotification", {
    Title = "Zolextoollock",
    Text = "subscribeToNechoscript"
})

function FindNearestEnemy()
    local ClosestDistance, ClosestPlayer = math.huge, nil
    local CenterPosition =
        Vector2.new(
        game:GetService("GuiService"):GetScreenResolution().X / 2,
        game:GetService("GuiService"):GetScreenResolution().Y / 2
    )

    for _, Player in ipairs(game:GetService("Players"):GetPlayers()) do
        if Player ~= LocalPlayer then
            local Character = Player.Character
            if Character and Character:FindFirstChild("HumanoidRootPart") and Character.Humanoid.Health > 0 then
                local Position, IsVisibleOnViewport =
                    game:GetService("Workspace").CurrentCamera:WorldToViewportPoint(Character.HumanoidRootPart.Position)

                if IsVisibleOnViewport then
                    local Distance = (CenterPosition - Vector2.new(Position.X, Position.Y)).Magnitude
                    if Distance < ClosestDistance then
                        ClosestPlayer = Character.HumanoidRootPart
                        ClosestDistance = Distance
                    end
                end
            end
        end
    end

    return ClosestPlayer
end

local enemy = nil

-- Function to aim the camera at the nearest enemy's HumanoidRootPart
RunService.Heartbeat:Connect(
    function()
        if CamlockState == true then
            if enemy then
                local camera = workspace.CurrentCamera
                camera.CFrame = CFrame.new(camera.CFrame.p, enemy.Position + enemy.Velocity * Prediction)
            end
        end
    end
)

Mouse.KeyDown:Connect(function(k)
    if k == getgenv().Key then
        Locked = not Locked
        if Locked then
            enemy = FindNearestEnemy()
            CamlockState = true
        else
            if enemy ~= nil then
                enemy = nil
                CamlockState = false
            end
        end
    end
end)

local tool = Instance.new("Tool")
tool.RequiresHandle = false
tool.Name = "ZolexTool"
tool.Activated:Connect(
    function()
        if not CamlockState then
            enemy = FindNearestEnemy()
            CamlockState = true
            game.StarterGui:SetCore("SendNotification", {
                Title = "Zolextoollock",
                Text = "Locked onto: " .. (enemy and enemy.Parent.Name or "none"),
                Duration = 5
            })
        else
            enemy = nil
            CamlockState = false
            game.StarterGui:SetCore("SendNotification", {
                Title = "Zolextoollock",
                Text = "Unlocked!",
                Duration = 5
            })
        end
    end
)
tool.Parent = game.Players.LocalPlayer.Backpack

game.StarterGui:SetCore(
    "SendNotification",
    {
        Title = "ZolexToollock",
        Text = "Sub to Nechoscript"
    }
)
